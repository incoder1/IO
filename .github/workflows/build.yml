name: build

on:
  push:
    branches:
      - 'master'
      - 'refactor'
    pull_request:

jobs:
  unix:
    strategy:
      matrix:
        os: [ubuntu]
        compiler: [g++, clang++]
        arch: [i686,x86_64]
        defines: [NDEBUG]
    name: ${{matrix.os}} (${{matrix.compiler}}, ${{matrix.defines}})
    runs-on: ${{matrix.os}}-latest
    steps:
      - uses: actions/checkout@v1
      - name: cmake configure
        run: cmake . -DCMAKE_BUILD_TYPE=Release -DBUILD_LIBRARY_TYPE=Static -D${{matrix.defines}}
      - name: cmake build
        run: cmake --build .
  windows:
    runs-on: windows-latest
    strategy:
      matrix:
        arch: [Win32, x64]
        defines: [_WIN32_WINNT=0x0A00, NDEBUG]
    steps:
      - uses: actions/checkout@v1
      - name: cmake configure
        run: cmake . -DCMAKE_BUILD_TYPE=Release -DBUILD_LIBRARY_TYPE=Static -D${{matrix.defines}}
      - name: cmake build
        run: MSBuild io.sln /p:Configuration=Release
